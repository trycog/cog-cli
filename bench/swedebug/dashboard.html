<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SWE-bench Debug Benchmark Dashboard</title>
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
  :root {
    --green: #22c55e;
    --green-dim: #22c55e66;
    --bg: #0d1117;
    --bg-card: #161b22;
    --bg-hover: #1c2129;
    --border: #30363d;
    --text: #e6edf3;
    --text-dim: #8b949e;
    --debug-color: #22c55e;
    --trad-color: #f97316;
    --fail-color: #f85149;
    --pass-color: #22c55e;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.5;
    min-height: 100vh;
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
  }

  .header {
    text-align: center;
    margin-bottom: 2rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid var(--border);
  }

  .header h1 {
    font-size: 1.8rem;
    font-weight: 600;
    color: var(--green);
    letter-spacing: -0.02em;
  }

  .header .subtitle {
    color: var(--text-dim);
    font-size: 0.9rem;
    margin-top: 0.3rem;
  }

  .model-badge {
    display: inline-block;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 0.25rem 0.75rem;
    font-size: 0.8rem;
    color: var(--text-dim);
    margin-top: 0.75rem;
    font-family: 'SF Mono', SFMono-Regular, Consolas, monospace;
  }

  .summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1.25rem;
    text-align: center;
  }

  .card .value {
    font-size: 2rem;
    font-weight: 700;
    color: var(--green);
    line-height: 1.2;
  }

  .card .label {
    font-size: 0.8rem;
    color: var(--text-dim);
    margin-top: 0.25rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .card .detail {
    font-size: 0.75rem;
    color: var(--text-dim);
    margin-top: 0.5rem;
    font-family: 'SF Mono', SFMono-Regular, Consolas, monospace;
  }

  .legend {
    display: flex;
    gap: 1.5rem;
    justify-content: center;
    margin-bottom: 1.5rem;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    font-size: 0.85rem;
    color: var(--text-dim);
  }

  .legend-dot {
    width: 10px;
    height: 10px;
    border-radius: 2px;
  }

  .chart-section {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
  }

  .chart-section h2 {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: var(--text);
  }

  .chart-section h2 span {
    color: var(--text-dim);
    font-weight: 400;
    font-size: 0.85rem;
  }

  .bar-label {
    fill: var(--text-dim);
    font-size: 12px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
  }

  .bar-value {
    fill: var(--text);
    font-size: 11px;
    font-family: 'SF Mono', SFMono-Regular, Consolas, monospace;
  }

  .axis text {
    fill: var(--text-dim);
    font-size: 11px;
  }

  .axis line, .axis path {
    stroke: var(--border);
  }

  .grid line {
    stroke: var(--border);
    stroke-opacity: 0.3;
  }

  .grid path {
    stroke: none;
  }

  .tooltip {
    position: absolute;
    background: #1c2129;
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 0.5rem 0.75rem;
    font-size: 0.8rem;
    color: var(--text);
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.15s;
    z-index: 100;
    white-space: nowrap;
  }

  .tooltip .tt-label {
    color: var(--text-dim);
    font-size: 0.7rem;
  }

  .tooltip .tt-value {
    font-family: 'SF Mono', SFMono-Regular, Consolas, monospace;
    font-weight: 600;
  }

  .table-section {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    overflow-x: auto;
  }

  .table-section h2 {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 1rem;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.85rem;
  }

  th {
    text-align: left;
    padding: 0.6rem 0.75rem;
    border-bottom: 1px solid var(--border);
    color: var(--text-dim);
    font-weight: 500;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.04em;
  }

  td {
    padding: 0.6rem 0.75rem;
    border-bottom: 1px solid #21262d;
    font-family: 'SF Mono', SFMono-Regular, Consolas, monospace;
    font-size: 0.8rem;
  }

  tr:last-child td { border-bottom: none; }

  td.name-col {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
    font-weight: 500;
    font-size: 0.85rem;
  }

  td.id-col {
    color: var(--text-dim);
    font-size: 0.7rem;
  }

  .method-debug { color: var(--debug-color); }
  .method-trad { color: var(--trad-color); }
  .ratio-cell { color: var(--green); font-weight: 600; }
  .pass { color: var(--pass-color); }
  .fail { color: var(--fail-color); }

  .no-data {
    text-align: center;
    padding: 3rem;
    color: var(--text-dim);
  }

  .no-data code {
    background: var(--bg-card);
    padding: 0.15rem 0.4rem;
    border-radius: 3px;
    font-size: 0.85rem;
    color: var(--green);
  }
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>SWE-bench Debug Benchmark</h1>
    <div class="subtitle">cog_debug_* Debugger vs Traditional Tools — Real-World Bug Diagnosis & Fix</div>
    <div class="model-badge" id="model-badge"></div>
  </div>

  <div id="no-data" class="no-data" style="display:none;">
    <p>No results found. Run benchmarks first:</p>
    <pre style="margin-top: 1rem; text-align: left; display: inline-block; color: var(--text-dim); font-size: 0.8rem;">
bash bench/swedebug/setup.sh
bash bench/swedebug/run.sh</pre>
  </div>

  <div id="dashboard">
    <div class="summary" id="summary"></div>

    <div class="legend">
      <div class="legend-item">
        <div class="legend-dot" style="background: var(--debug-color);"></div>
        Debugger (cog_debug_*)
      </div>
      <div class="legend-item">
        <div class="legend-dot" style="background: var(--trad-color);"></div>
        Traditional (Read + Edit + Bash)
      </div>
    </div>

    <div class="chart-section" id="cost-section" style="display:none;">
      <h2>Cost by Task <span>(lower is better, USD)</span></h2>
      <div id="chart-cost"></div>
    </div>

    <div class="chart-section" id="tokens-section" style="display:none;">
      <h2>Total Tokens by Task <span>(lower is better)</span></h2>
      <div id="chart-tokens"></div>
    </div>

    <div class="chart-section">
      <h2>LLM Rounds by Task <span>(lower is better)</span></h2>
      <div id="chart-rounds"></div>
    </div>

    <div class="chart-section" id="duration-section" style="display:none;">
      <h2>Duration by Task <span>(lower is better, seconds)</span></h2>
      <div id="chart-duration"></div>
    </div>

    <div class="table-section">
      <h2>Raw Data</h2>
      <table id="data-table"></table>
    </div>
  </div>
</div>

<div class="tooltip" id="tooltip"></div>

<!-- SWE_DATA_START -->
<script>
const SWE_DATA = {
  "model": "",
  "date": "",
  "tasks": []
};
</script>
<!-- SWE_DATA_END -->

<script>
const DEBUG_COLOR = '#22c55e';
const TRAD_COLOR = '#f97316';

if (typeof SWE_DATA !== 'undefined' && SWE_DATA.tasks && SWE_DATA.tasks.length > 0) {
  render(SWE_DATA);
} else {
  document.getElementById('dashboard').style.display = 'none';
  document.getElementById('no-data').style.display = '';
}

function render(data) {
  document.getElementById('model-badge').textContent =
    (data.model || 'unknown') + ' — ' + (data.date || '');

  const results = data.tasks;

  const hasCost = results.some(r => (r.debug.cost_usd || 0) > 0 || (r.traditional.cost_usd || 0) > 0);
  const hasTokens = results.some(r => (r.debug.input_tokens || 0) > 0 || (r.traditional.input_tokens || 0) > 0);
  const hasDuration = results.some(r => (r.debug.duration_ms || 0) > 0 || (r.traditional.duration_ms || 0) > 0);

  renderSummary(results, hasCost, hasTokens);
  if (hasCost) {
    document.getElementById('cost-section').style.display = '';
    renderGroupedBars('#chart-cost', results, d => d.cost_usd || 0, v => '$' + v.toFixed(4));
  }
  if (hasTokens) {
    document.getElementById('tokens-section').style.display = '';
    renderGroupedBars('#chart-tokens', results, d => (d.input_tokens || 0) + (d.output_tokens || 0), v => v >= 1000 ? (v/1000).toFixed(1) + 'k' : String(v));
  }
  renderGroupedBars('#chart-rounds', results, d => d.rounds);
  if (hasDuration) {
    document.getElementById('duration-section').style.display = '';
    renderGroupedBars('#chart-duration', results, d => (d.duration_ms || 0) / 1000, v => v.toFixed(1) + 's');
  }
  renderTable(results, hasCost, hasTokens, hasDuration);
}

function renderSummary(results, hasCost, hasTokens) {
  const totals = results.reduce((acc, r) => ({
    dbgCalls: acc.dbgCalls + r.debug.calls,
    tradCalls: acc.tradCalls + r.traditional.calls,
    dbgRounds: acc.dbgRounds + r.debug.rounds,
    tradRounds: acc.tradRounds + r.traditional.rounds,
    dbgCost: acc.dbgCost + (r.debug.cost_usd || 0),
    tradCost: acc.tradCost + (r.traditional.cost_usd || 0),
    dbgTokens: acc.dbgTokens + (r.debug.input_tokens || 0) + (r.debug.output_tokens || 0),
    tradTokens: acc.tradTokens + (r.traditional.input_tokens || 0) + (r.traditional.output_tokens || 0),
    dbgVerified: acc.dbgVerified + (r.debug.verified ? 1 : 0),
    tradVerified: acc.tradVerified + (r.traditional.verified ? 1 : 0),
  }), { dbgCalls: 0, tradCalls: 0, dbgRounds: 0, tradRounds: 0, dbgCost: 0, tradCost: 0, dbgTokens: 0, tradTokens: 0, dbgVerified: 0, tradVerified: 0 });

  const roundRatio = totals.dbgRounds > 0 ? (totals.tradRounds / totals.dbgRounds).toFixed(1) : '–';
  const costRatio = totals.dbgCost > 0 ? (totals.tradCost / totals.dbgCost).toFixed(1) : '–';
  const tokenRatio = totals.dbgTokens > 0 ? (totals.tradTokens / totals.dbgTokens).toFixed(1) : '–';
  const fmtK = n => n >= 1000 ? (n/1000).toFixed(0) + 'k' : String(n);

  let html = '';

  if (hasCost) {
    html += `
    <div class="card">
      <div class="value">${costRatio}x</div>
      <div class="label">Cost Savings</div>
      <div class="detail">$${totals.dbgCost.toFixed(2)} vs $${totals.tradCost.toFixed(2)}</div>
    </div>`;
  }

  if (hasTokens) {
    html += `
    <div class="card">
      <div class="value">${tokenRatio}x</div>
      <div class="label">Fewer Tokens</div>
      <div class="detail">${fmtK(totals.dbgTokens)} vs ${fmtK(totals.tradTokens)}</div>
    </div>`;
  }

  html += `
    <div class="card">
      <div class="value">${roundRatio}x</div>
      <div class="label">Fewer Rounds</div>
      <div class="detail">${totals.dbgRounds} vs ${totals.tradRounds}</div>
    </div>
    <div class="card">
      <div class="value">${totals.dbgVerified}/${results.length}</div>
      <div class="label">Debugger Verified</div>
      <div class="detail">Traditional: ${totals.tradVerified}/${results.length}</div>
    </div>`;

  document.getElementById('summary').innerHTML = html;
}

function renderGroupedBars(selector, results, accessor, fmt) {
  if (!fmt) fmt = v => String(v);
  const container = d3.select(selector);
  const containerWidth = container.node().getBoundingClientRect().width;
  const margin = { top: 8, right: 60, bottom: 20, left: 280 };
  const width = containerWidth - margin.left - margin.right;
  const barHeight = 16;
  const groupPad = 10;

  const groupHeight = barHeight * 2 + 4;
  const height = results.length * (groupHeight + groupPad) - groupPad;

  const svg = container.append('svg')
    .attr('width', width + margin.left + margin.right)
    .attr('height', height + margin.top + margin.bottom);

  const g = svg.append('g')
    .attr('transform', `translate(${margin.left},${margin.top})`);

  const maxVal = d3.max(results, d => Math.max(accessor(d.debug), accessor(d.traditional)));

  const x = d3.scaleLinear()
    .domain([0, (maxVal || 1) * 1.15])
    .range([0, width]);

  g.append('g')
    .attr('class', 'grid')
    .attr('transform', `translate(0,${height})`)
    .call(d3.axisBottom(x).tickSize(-height).tickFormat('').ticks(5));

  results.forEach((r, i) => {
    const yOffset = i * (groupHeight + groupPad);
    const displayName = r.name.length > 40 ? r.name.slice(0, 38) + '...' : r.name;

    g.append('text')
      .attr('class', 'bar-label')
      .attr('x', -8)
      .attr('y', yOffset + groupHeight / 2)
      .attr('text-anchor', 'end')
      .attr('dominant-baseline', 'middle')
      .text(displayName);

    const dbgVal = accessor(r.debug);
    g.append('rect')
      .attr('x', 0).attr('y', yOffset)
      .attr('width', 0).attr('height', barHeight)
      .attr('rx', 3).attr('fill', DEBUG_COLOR).attr('opacity', 0.85)
      .on('mouseover', (event) => showTooltip(event, 'Debugger', r.name, dbgVal))
      .on('mouseout', hideTooltip)
      .transition().duration(600).delay(i * 50)
      .attr('width', x(dbgVal));

    g.append('text')
      .attr('class', 'bar-value')
      .attr('x', x(dbgVal) + 6)
      .attr('y', yOffset + barHeight / 2)
      .attr('dominant-baseline', 'middle')
      .attr('opacity', 0)
      .text(fmt(dbgVal))
      .transition().duration(600).delay(i * 50)
      .attr('opacity', 1);

    const tradVal = accessor(r.traditional);
    g.append('rect')
      .attr('x', 0).attr('y', yOffset + barHeight + 4)
      .attr('width', 0).attr('height', barHeight)
      .attr('rx', 3).attr('fill', TRAD_COLOR).attr('opacity', 0.85)
      .on('mouseover', (event) => showTooltip(event, 'Traditional', r.name, tradVal))
      .on('mouseout', hideTooltip)
      .transition().duration(600).delay(i * 50 + 60)
      .attr('width', x(tradVal));

    g.append('text')
      .attr('class', 'bar-value')
      .attr('x', x(tradVal) + 6)
      .attr('y', yOffset + barHeight + 4 + barHeight / 2)
      .attr('dominant-baseline', 'middle')
      .attr('opacity', 0)
      .text(fmt(tradVal))
      .transition().duration(600).delay(i * 50 + 60)
      .attr('opacity', 1);
  });
}

function renderTable(results, hasCost, hasTokens, hasDuration) {
  const table = document.getElementById('data-table');
  let rows = '';
  const fmtK = n => n >= 1000 ? (n/1000).toFixed(1) + 'k' : String(n);

  results.forEach(r => {
    const costD = r.debug.cost_usd || 0;
    const costT = r.traditional.cost_usd || 0;
    const ratio = costD > 0 ? (costT / costD).toFixed(1) + 'x' : '–';
    const tokD = (r.debug.input_tokens || 0) + (r.debug.output_tokens || 0);
    const tokT = (r.traditional.input_tokens || 0) + (r.traditional.output_tokens || 0);
    const durD = (r.debug.duration_ms || 0) / 1000;
    const durT = (r.traditional.duration_ms || 0) / 1000;
    const verD = r.debug.verified;
    const verT = r.traditional.verified;
    rows += `
      <tr>
        <td class="name-col" rowspan="2">${r.name}</td>
        <td class="id-col" rowspan="2">${r.instance_id || ''}</td>
        <td class="method-debug">Debugger</td>
        <td>${r.debug.calls}</td>
        <td>${r.debug.rounds}</td>
        ${hasTokens ? `<td>${fmtK(tokD)}</td>` : ''}
        ${hasCost ? `<td>$${costD.toFixed(4)}</td>` : ''}
        ${hasDuration ? `<td>${durD.toFixed(1)}s</td>` : ''}
        <td class="${r.debug.pass ? 'pass' : 'fail'}">${r.debug.pass ? 'PASS' : 'FAIL'}</td>
        <td class="${verD ? 'pass' : 'fail'}">${verD ? 'YES' : 'NO'}</td>
        <td class="ratio-cell">${ratio}</td>
      </tr>
      <tr>
        <td class="method-trad">Traditional</td>
        <td>${r.traditional.calls}</td>
        <td>${r.traditional.rounds}</td>
        ${hasTokens ? `<td>${fmtK(tokT)}</td>` : ''}
        ${hasCost ? `<td>$${costT.toFixed(4)}</td>` : ''}
        ${hasDuration ? `<td>${durT.toFixed(1)}s</td>` : ''}
        <td class="${r.traditional.pass ? 'pass' : 'fail'}">${r.traditional.pass ? 'PASS' : 'FAIL'}</td>
        <td class="${verT ? 'pass' : 'fail'}">${verT ? 'YES' : 'NO'}</td>
        <td></td>
      </tr>`;
  });

  table.innerHTML = `
    <thead>
      <tr>
        <th>Task</th>
        <th>Instance</th>
        <th>Method</th>
        <th>Calls</th>
        <th>Rounds</th>
        ${hasTokens ? '<th>Tokens</th>' : ''}
        ${hasCost ? '<th>Cost</th>' : ''}
        ${hasDuration ? '<th>Duration</th>' : ''}
        <th>Result</th>
        <th>Verified</th>
        <th>Cost Ratio</th>
      </tr>
    </thead>
    <tbody>${rows}</tbody>
  `;
}

function showTooltip(event, method, name, value) {
  const tooltip = document.getElementById('tooltip');
  tooltip.innerHTML = `
    <div class="tt-label">${name}</div>
    <div class="tt-value">${method}: ${value}</div>
  `;
  tooltip.style.opacity = 1;
  tooltip.style.left = (event.pageX + 12) + 'px';
  tooltip.style.top = (event.pageY - 10) + 'px';
}

function hideTooltip() {
  document.getElementById('tooltip').style.opacity = 0;
}
</script>
</body>
</html>
